





<div class="container">

  <!--For User without Vineyard-->
  <div *ngIf="!vineyard.id">
    <p class="text-center">You are not a member of any Vineyard.</p>
    <p class="text-center">You can create a new Vineyard</p>

    <a *ngIf="!createVineyardMode" (click)="toggleCreateVineyard()">
      <button type="button" class="btn btn-dark mb-4">Create Vineyard</button>
    </a>
    <a *ngIf="createVineyardMode" (click)="toggleCreateVineyard()">
      <button type="button" class="btn btn-outline-dark mb-4">Hide</button>
    </a>

    <!--Create Vineyard-->
    <div *ngIf="createVineyardMode">
      <div class="alert alert-danger" role="alert" *ngIf="createVineyardErrorMessages.length">
        <p *ngFor="let msg of createVineyardErrorMessages">{{ msg.message }}</p>
      </div>

      <h3 class="form-signin-heading">Create Vineyard</h3>

      <br/>
      <label for="dba" class="sr-only">Vineyard DBA name</label>
      <input type="text" id="dba" name="dba" [(ngModel)]="createVineyardRequest.dbaName"
             class="form-control mb-4" placeholder="enter dba name of vineyard here" required>

      <label for="company" class="sr-only">Company name</label>
      <input type="text" id="company" name="company" [(ngModel)]="createVineyardRequest.companyName"
             class="form-control mb-4" placeholder="enter company name here" required>

      <label for="email" class="sr-only">Email</label>
      <input type="text" id="email" name="email" [(ngModel)]="createVineyardRequest.email"
             class="form-control mb-4" placeholder="enter email here" required>

      <label for="phoneNumber" class="sr-only">Phone number</label>
      <input type="text" id="phoneNumber" name="phoneNumber" [(ngModel)]="createVineyardRequest.phoneNumber"
             class="form-control mb-4" placeholder="enter phone number here" required>

      <label for="city" class="sr-only">City</label>
      <input type="text" id="city" name="city" [(ngModel)]="createVineyardRequest.city"
             class="form-control mb-4" placeholder="enter city name here" required>

      <label for="streetAddress" class="sr-only">Street address</label>
      <input type="text" id="streetAddress" name="streetAddress" [(ngModel)]="createVineyardRequest.streetAddress"
             class="form-control mb-4" placeholder="enter street address here" required>

      <label for="zipCode" class="sr-only">Zip code</label>
      <input type="text" id="zipCode" name="zipCode" [(ngModel)]="createVineyardRequest.zipCode"
             class="form-control mb-4" placeholder="enter zip code here" required>

      <button class="btn btn-lg btn-outline-dark mb-4"
              (click)="createVineyard()"
              [disabled]="!createVineyardRequest.dbaName || !createVineyardRequest.companyName ||
              !createVineyardRequest.email || !createVineyardRequest.phoneNumber || !createVineyardRequest.city
              || !createVineyardRequest.streetAddress || !createVineyardRequest.zipCode">Create
      </button>
    </div>
  </div>

  <div *ngIf="vineyard.id" class="row">
    <div class="col-5">

      <!--Vineyard Info-->
      <div class="mb-3">
        <h3 class="mb-3">Vineyard Info</h3>
        <p><b>DBA name:</b> {{ vineyard.dbaName }}</p>
        <p><b>Company name:</b> {{ vineyard.companyName }}</p>
        <p><b>Email:</b> {{ vineyard.email }}</p>
        <p><b>Phone number:</b> {{ vineyard.phoneNumber }}</p>
        <p><b>City:</b> {{ vineyard.city }}</p>
        <p><b>Street Address:</b> {{ vineyard.streetAddress }}</p>
        <p><b>Zip Code:</b> {{ vineyard.zipCode }}</p>
        <p><b>Creation Date:</b> {{ vineyard.createdAt | date:'long' }}</p>
        <p><b>Creator Name:</b> {{ vineyard.createdBy }}</p>
        <p><b>Last Modified
          Date:</b> {{ vineyard.lastUpdatedAt != null ? vineyard.lastUpdatedAt : 'No modifications yet' }}</p>
        <p><b>Last Modified
          By:</b> {{ vineyard.lastUpdatedBy != null ? vineyard.lastUpdatedBy : 'No modifications yet' }}</p>
      </div>

      <!--Vineyard Director Info-->
      <div class="">
        <ng-container *ngIf="user.role == 'VINEYARD_DIRECTOR'">
          <a *ngIf="!editVineyardMode" (click)="toggleEditVineyard()">
            <button type="button" class="btn btn-dark mb-4">Edit Vineyard Info</button>
          </a>
          <a *ngIf="editVineyardMode" (click)="toggleEditVineyard()">
            <button type="button" class="btn btn-outline-dark mb-4">Hide</button>
          </a>

          <a *ngIf="!deleteVineyardMode" (click)="toggleDeleteVineyard()">
            <button type="button" class="btn btn-danger mx-3 mb-4">Delete Vineyard</button>
          </a>
          <a *ngIf="deleteVineyardMode" (click)="toggleDeleteVineyard()">
            <button type="button" class="btn btn-danger mx-3 mb-4">Hide</button>
          </a>
          <a *ngIf="deleteVineyardMode" (click)="deleteVineyard()">
            <button type="button" class="btn btn-outline-danger mb-4">Confirm</button>
          </a>

          <div *ngIf="editVineyardMode">
            <h3 class="form-signin-heading">Edit Vineyard Info</h3>

            <div class="alert alert-danger" role="alert" *ngIf="editVineyardErrorMessages.length">
              <p *ngFor="let msg of editVineyardErrorMessages">{{ msg.message }}</p>
            </div>

            <br/>
            <label for="dba" class="sr-only">Vineyard DBA name</label>
            <input type="text" id="editDba" name="dba" [(ngModel)]="editVineyardRequest.dbaName"
                   class="form-control mb-4" placeholder="enter dba name of vineyard here" required>

            <label for="company" class="sr-only">Company name</label>
            <input type="text" id="editCompany" name="company" [(ngModel)]="editVineyardRequest.companyName"
                   class="form-control mb-4" placeholder="enter company name here" required>

            <label for="email" class="sr-only">Email</label>
            <input type="text" id="editEmail" name="email" [(ngModel)]="editVineyardRequest.email"
                   class="form-control mb-4" placeholder="enter email here" required>

            <label for="phoneNumber" class="sr-only">Phone number</label>
            <input type="text" id="editPhoneNumber" name="phoneNumber" [(ngModel)]="editVineyardRequest.phoneNumber"
                   class="form-control mb-4" placeholder="enter phone number here" required>

            <label for="city" class="sr-only">City</label>
            <input type="text" id="editCity" name="city" [(ngModel)]="editVineyardRequest.city"
                   class="form-control mb-4" placeholder="enter city name here" required>

            <label for="streetAddress" class="sr-only">Street address</label>
            <input type="text" id="editStreetAddress" name="streetAddress"
                   [(ngModel)]="editVineyardRequest.streetAddress"
                   class="form-control mb-4" placeholder="enter street address here" required>

            <label for="zipCode" class="sr-only">Zip code</label>
            <input type="text" id="editZipCode" name="zipCode" [(ngModel)]="editVineyardRequest.zipCode"
                   class="form-control mb-4" placeholder="enter zip code here" required>

            <button class="btn btn-dark mb-4"
                    (click)="editVineyard()"
                    [disabled]="!editVineyardRequest.dbaName || !editVineyardRequest.companyName ||
                  !editVineyardRequest.email || !editVineyardRequest.phoneNumber || !editVineyardRequest.city
                  || !editVineyardRequest.streetAddress || !editVineyardRequest.zipCode">Edit
            </button>
          </div>
        </ng-container>
      </div>

      <!--Create block-->
      <!--Block Info-->
      <div class="">
        <ng-container *ngIf="user.role == 'VINEYARD_DIRECTOR' || user.role == 'VINEYARD_MANAGER'">
          <h4>You can create a new block.</h4>

          <div *ngIf="createBlockErrorMessages.length">
            <div class="alert alert-danger" role="alert">
              <p *ngFor="let msg of createBlockErrorMessages">{{ msg.message }}</p>
            </div>
          </div>

          <a *ngIf="!createBlockMode" (click)="toggleCreateBlock()">
            <button type="button" class="btn btn-dark mb-4">Create Block</button>
          </a>
          <a *ngIf="createBlockMode" (click)="toggleCreateBlock()">
            <button type="button" class="btn btn-outline-dark">Hide</button>
          </a>

          <div *ngIf="createBlockMode">
            <br/>
            <label for="blockName" class="sr-only">Block Name</label>
            <input type="text" id="blockName" name="blockName" [(ngModel)]="createBlockRequest.name"
                   class="form-control mb-4" placeholder="enter name of block here" required>

            <label for="partitioningType" class="sr-only">Partitioning Type</label>
            <input type="text" id="partitioningType" name="partitioningType"
                   [(ngModel)]="createBlockRequest.partitioningType"
                   class="form-control mb-4" placeholder="enter partitioning type here" required>

            <label for="rowOrientation" class="sr-only">Row Orientation</label>
            <input type="text" id="rowOrientation" name="rowOrientation"
                   [(ngModel)]="createBlockRequest.rowOrientation"
                   class="form-control mb-4" placeholder="enter row orientation here" required>

            <label for="rowSpacing" class="sr-only">Row Spacing</label>
            <input type="number" id="rowSpacing" name="rowSpacing" [(ngModel)]="createBlockRequest.rowSpacing"
                   class="form-control mb-4" placeholder="enter row spacing here" required>

            <label for="trellisSystemType" class="sr-only">Trellis System Type</label>
            <input type="text" id="trellisSystemType" name="trellisSystemType"
                   [(ngModel)]="createBlockRequest.trellisSystemType"
                   class="form-control mb-4" placeholder="enter trellis system type here" required>

            <label for="vineSpacing" class="sr-only">Vine Spacing</label>
            <input type="number" id="vineSpacing" name="vineSpacing" [(ngModel)]="createBlockRequest.vineSpacing"
                   class="form-control mb-4" placeholder="enter vine spacing here" required>

            <button class="btn btn-dark mb-4" type="submit" [disabled]="
          !createBlockRequest.name || !createBlockRequest.partitioningType || !createBlockRequest.rowOrientation
          || !createBlockRequest.rowSpacing || !createBlockRequest.trellisSystemType || !createBlockRequest.vineSpacing"
                    (click)="createBlock()">Create
            </button>
          </div>
        </ng-container>
        <div>
          <h4>{{ vineyard.dbaName }} Blocks:</h4>
          <hr/>
          <div *ngIf="!blocks.length"><p>There isn`t any block created yet.</p></div>
          <div *ngFor="let block of blocks">
            <p><b>Name:</b> {{ block.name }}</p>
            <p><b>Partition type:</b> {{ block.partitioningType }}</p>
            <p><b>Row orientation:</b> {{ block.rowOrientation }}</p>
            <p><b>Trellis system:</b> {{ block.trellisSystemType }}</p>
            <a [routerLink]="['/vineyard', vineyard.id, 'block', block.id]">
              <button type="button" class="btn btn-dark">Go to block</button>
            </a>
            <hr>
          </div>
        </div>
      </div>

    </div>

    <div class="col-1"></div>

    <div class="col-6">

      <!--Vineyard Employees Management-->
      <div class="">
        <h3 class="mb-3"> {{ vineyard.dbaName }} Employees:</h3>
        <!-- Error Messages -->
        <div *ngIf="hireEmployeeErrorMessages.length">
          <div class="alert alert-danger" role="alert">
            <p *ngFor="let msg of hireEmployeeErrorMessages">{{ msg.message }}</p>
          </div>
        </div>

        <div *ngIf="user.role == 'VINEYARD_DIRECTOR'">
          <h5>You can hire a new employee.</h5>
          <a *ngIf="!hireEmployeeMode" (click)="toggleHireEmployee()">
            <button type="button" class="btn btn-dark mb-4">Hire Employee</button>
          </a>
          <a *ngIf="hireEmployeeMode" (click)="toggleHireEmployee()">
            <button type="button" class="btn btn-outline-dark">Hide</button>
          </a>
        </div>

        <!-- Hire Employee Form -->
        <div *ngIf="hireEmployeeMode">
          <br/>
          <label for="firstName" class="sr-only">User ID</label>
          <input type="text" id="firstName" name="firstName" [(ngModel)]="hireEmployeeRequest.staffId"
                 class="form-control mb-4" placeholder="enter first name of employee here" required>

          <label for="role" class="sr-only">Role</label>
          <select id="role" name="role" [(ngModel)]="hireEmployeeRequest.vineyardRole" class="form-control mb-4"
                  required>
            <option value="VINEYARD_MANAGER">Vineyard Manager</option>
            <option value="VINEYARD_WORKER">Vineyard Worker</option>
          </select>

          <button class="btn btn-dark mb-4" type="submit" [disabled]="
            !hireEmployeeRequest.staffId || !hireEmployeeRequest.vineyardRole"
                  (click)="hireStaff()">Hire
          </button>
        </div>

        <!-- Employees List -->
        <div>
          <hr>
          <div *ngIf="!staff.length"><p>There isn`t any employee in this vineyard yet.</p></div>
          <div *ngFor="let employee of staff">
            <p><b>First name:</b> {{ employee.firstName }} </p>
            <p><b>Last name:</b> {{ employee.lastName }}</p>
            <p><b>Email:</b> {{ employee.email }}</p>
            <p><b>Role:</b> {{ employee.role }}</p>
            <button *ngIf="employee.role != 'VINEYARD_DIRECTOR' && user.role == 'VINEYARD_DIRECTOR'"
                    type="button" class="btn btn-danger"
                    (click)="fireStaff(employee.id)">Fire
            </button>
            <button *ngIf="employee.role != 'VINEYARD_DIRECTOR' && user.role == 'VINEYARD_DIRECTOR'"
                    type="button" class="btn btn-dark mx-3"
                    (click)="toggleEditStaff(employee.id)">Edit
            </button>

            <div *ngIf="editStaffMode && editStaffId == employee.id">
              <br/>
              <select id="vineyardRole" name="vineyardRole" [(ngModel)]="editStaffRequest.vineyardRole"
                      class="form-control mb-4"
                      required>
                <option value="VINEYARD_MANAGER">Vineyard Manager</option>
                <option value="VINEYARD_WORKER">Vineyard Worker</option>
              </select>

              <button class="btn btn-dark mb-4" type="submit" [disabled]="!editStaffRequest.vineyardRole"
                      (click)="editStaff()">Confirm
              </button>
            </div>
            <hr>
          </div>

        </div>
      </div>

      <!--Create group-->
      <!--Group Info-->
      <div class="">
        <ng-container *ngIf="user.role == 'VINEYARD_DIRECTOR' || user.role == 'VINEYARD_MANAGER'">
          <h4>You can create a new group.</h4>
          <div *ngIf="createGroupErrorMessages.length">
            <div class="alert alert-danger" role="alert">
              <p *ngFor="let msg of createGroupErrorMessages">{{ msg.message }}</p>
            </div>
          </div>

          <a *ngIf="!createGroupMode" (click)="toggleCreateGroup()">
            <button type="button" class="btn btn-dark mb-4">Create Group</button>
          </a>
          <a *ngIf="createGroupMode" (click)="toggleCreateGroup()">
            <button type="button" class="btn btn-outline-dark">Hide</button>
          </a>

          <div *ngIf="createGroupMode">
            <br/>
            <label for="groupName" class="sr-only">Group Name</label>
            <input type="text" id="groupName" name="groupName" [(ngModel)]="createGroupRequest.name"
                   class="form-control mb-4" placeholder="enter name of group here" required>

            <label for="groupDescription" class="sr-only">Group Description</label>
            <input type="text" id="groupDescription" name="groupDescription"
                   [(ngModel)]="createGroupRequest.description"
                   class="form-control mb-4" placeholder="enter description of group here" required>

            <label for="formationReason" class="sr-only">Formation Reason</label>
            <input type="text" id="formationReason" name="formationReason"
                   [(ngModel)]="createGroupRequest.formationReason"
                   class="form-control mb-4" placeholder="enter formation reason here" required>

            <button class="btn btn-dark mb-4" type="submit" [disabled]="
          !createGroupRequest.name || !createGroupRequest.description || !createGroupRequest.formationReason"
                    (click)="createGroup()">Create
            </button>
          </div>
        </ng-container>
        <div>
          <h4>{{ vineyard.dbaName }} Groups:</h4>
          <hr>
          <div *ngIf="!groups.length"><p>There isn`t any group created yet.</p></div>
          <div *ngFor="let group of groups">
            <p><b>Name:</b> {{ group.name }}</p>
            <p><b>Description:</b> {{ group.description }}</p>
            <p><b>Formation reason:</b> {{ group.formationReason }}</p>
            <a [routerLink]="['/vineyard', vineyard.id, 'group', group.id]">
              <button type="button" class="btn btn-dark">Go to group</button>
            </a>
            <hr>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
